workspace:

createWorkspace â€“ What It Does:
Creates a new workspace under the logged-in userâ€™s organization.
Steps:
â— Validates workspace name and description.
â— Checks for duplicate workspace names for the user.
â— Creates the workspace.
â— Assigns the creator as a WorkspaceAdmin member.
â— Generates a workspace-specific JWT token and sets it in a cookie.
â— Updates the userâ€™s currentWorkspace.
ğŸ”‘ updateWorkspace â€“ What It Does:
Updates an existing workspaceâ€™s name and description.
Steps:
â— Validates workspace inputs.
â— Fetches the workspace by ID.
â— Updates name and description.
ğŸ”‘ deleteWorkspace â€“ What It Does:
Soft-deletes a workspace and its related projects and members.
Steps:
â— Marks the workspace as isDeleted: true.
â— Marks all projects under the workspace as deleted.
â— Marks all workspace members as deleted.
ğŸ”‘ getAllWorkspace â€“ What It Does:
Fetches all active workspaces in the organization for admin access.
ğŸ”‘ getMyWorkspace â€“ What It Does:
Fetches all workspaces the logged-in user is an active member of.
ğŸ”‘ getWorkspaceById â€“ What It Does:
Fetches a specific workspace by ID.
Steps:
â— Validates workspace ID.
â— Checks if the user is a member of the workspace.
â— Fetches workspace details along with creator info.
â— Generates workspace-specific JWT token.
ğŸ”‘ getWorkspaceAnalytics â€“ What It Does:
Generates analytics for a workspace.
Steps:
â— Counts total projects and members.
â— Counts active and completed tasks.
â— Aggregates tasks per member.
â— Aggregates tasks per project and per team.
â— Calculates workload distribution.
ğŸ”‘ workspacemember â€“ What It Does:
Fetches members of a workspace with optional filters.
Steps:
â— Supports pagination, email search, and custom permission filters.
â— Populates user and role info.
â— Returns members with their permissions and status.
ğŸ”‘ AddworkspaceMember â€“ What It Does:
Adds a user to a workspace.
Steps:
â— Validates workspace and organization membership.
â— Checks if user is already a member.
â— Assigns the specified role.
â— Creates a new workspace member record.
ğŸ”‘ RemoveworkspaceMember â€“ What It Does:
Removes a user from a workspace (soft delete).
Steps:
â— Validates workspace and user.
â— Marks the member as deleted and sets status: removed.
â— Sends an email notification to the removed user.


project:

createProject â€“ What It Does
â— Extracts user and organization context from auth token
â— Validates workspace ID and project input using Zod
â— Checks that:
â—‹ Workspace exists
â—‹ Project template exists
â—‹ Project name is unique in the workspace
â— Validates workflow states in the template
â— Finds the â€œProjectAdminâ€ role for the project owner
â— Creates the main project document
â— Creates associated workflow and board from the template
â— Attaches board to the project
â— Creates automation rules if defined in the template
â— Creates project membership for the creator with owner role
â— Creates tasks based on the template
â— Generates a project-specific token and sets it in cookie
âœï¸ updateProject â€“ What It Does
â— Placeholder route (currently only acknowledges the route hit)
ğŸ—‘ deleteProject â€“ What It Does
â— Validates workspace and project IDs
â— Finds project scoped to workspace and organization
â— Deletes:
â—‹ Project members
â—‹ Tasks
â—‹ Boards
â—‹ Workflows
â—‹ Audit logs
â—‹ Teams and team members associated with the project
â— Deletes the project itself
â— Uses MongoDB session + transaction to ensure atomicity
ğŸ—„ archiveProject â€“ What It Does
â— Placeholder route (intended for archiving a project)
ğŸ“‚ getAllProjectsByWorkspace â€“ What It Does
â— Validates workspace ID
â— Extracts query parameters (pagination, filters like visibility, type, archive status)
â— Fetches projects in the workspace with applied filters
â— Populates creator info
â— Returns paginated list of projects
ğŸ‘¤ getMyProjectsByWorkspace â€“ What It Does
â— Validates workspace ID
â— Fetches projects where the authenticated user is a member
â— Returns list of projects in the workspace that the user belongs to
ğŸ” getProjectById â€“ What It Does
â— Validates project ID and workspace ID
â— Checks that the project exists in the workspace and organization
â— Fetches project details along with:
â—‹ Creator info
â—‹ Workspace info
â—‹ Organization info
â—‹ Board info
â— Checks if the user is a project member
â— Fetches role and permissions
â— Generates project token and sets cookie
â— Returns project details
ğŸ‘¥ getAssignableMembers â€“ What It Does
â— Validates workspace ID
â— Confirms project belongs to workspace and organization
â— Fetches all project members
â— Fetches all workspace members
â— Returns users who are part of the workspace but not yet assigned to the project
ğŸ“Š getProjectAnalytics â€“ What It Does
â— Validates project ID
â— Confirms project exists
â— Calculates project metrics:
â—‹ Total tasks
â—‹ Completed tasks
â—‹ Pending tasks
â—‹ Overdue tasks
â—‹ Tasks per member
â—‹ Tasks per workflow state
â— Returns aggregated analytics for the project


teams:

createTeam â€“ What It Does:
Creates a new team in a project and optionally attaches a custom board.
Steps:
â— Validates required fields (name, workspaceId, projectId).
â— Checks for duplicate team names within the project.
â— Verifies the creator is a project member.
â— Creates the team record and adds the creator as a TeamAdmin.
â— If useTeamBoard is false, creates a custom workflow and board from a template.
â— If useTeamBoard is true, links the team to the project board.
â— Generates a team-specific JWT token and sets it in a cookie.
ğŸ”‘ getTeamsByWorkspace â€“ What It Does:
Fetches all teams in a workspace or project with pagination.
Steps:
â— Validates workspaceId and/or projectId.
â— Supports pagination (page, limit).
â— Returns team details with creator info and project names.
ğŸ”‘ addTeamMember â€“ What It Does:
Adds a user to a team with a specific role.
Steps:
â— Validates teamId, projectId, memberId, and role.
â— Checks for duplicates.
â— Fetches role permissions from the database.
â— Creates a TeamMember record.
â— Increments the teamâ€™s membersCount.
ğŸ”‘ getTeamMembers â€“ What It Does:
Fetches all members of a specific team within a project.
Steps:
â— Validates teamId and projectId.
â— Aggregates detailed member info: user profile, role, permissions, addedBy info.
â— Returns a structured list of members.
ğŸ”‘ removeTeamMember â€“ What It Does:
Removes a member from a team permanently.
Steps:
â— Validates teamId and memberâ€™s team ID.
â— Deletes the TeamMember record.
â— Optionally decrements the teamâ€™s membersCount.
ğŸ”‘ changeMemberRoleInTeam â€“ What It Does:
Changes the role or custom permissions of a team member.
Steps:
â— Validates teamId, projectId, memberId, and role.
â— Prevents assigning TeamAdmin role.
â— Updates role or overrides permissions if provided.
â— Returns the memberâ€™s updated role and permissions.
ğŸ”‘ toggleArchiveTeam â€“ What It Does:
Archives or unarchives a team.
Steps:
â— Validates teamId.
â— Sets isArchived to true or false.
â— Returns updated team status.
ğŸ”‘ deleteTeam â€“ What It Does:
Deletes a team and its related data.
Steps:
â— Validates teamId and projectId.
â— Deletes custom workflow and board if the team has a custom board.
â— Deletes the team record and all TeamMember records.
â— Removes assignedTeamId from tasks in the project.
ğŸ”‘ getMyTeamsByWorkspace â€“ What It Does:
Fetches all teams in a workspace that the logged-in user belongs to.
Steps:
â— Finds the userâ€™s ProjectMember record.
â— Fetches TeamMember entries for the user.
â— Returns all teams in the requested workspace.
ğŸ”‘ getTeamById â€“ What It Does:
Fetches a single team by ID.
Steps:
â— Validates teamId.
â— Checks if the user is a project member.
â— Returns team details including creator info.
ğŸ”‘ getAssignableMembersForTeam â€“ What It Does:
Fetches project members who can be added to a team.
Steps:
â— Fetches all active project members.
â— Excludes members already in the team.
â— Returns a list of assignable members.
workflow
createWorkflow â€“ What It Does:
Creates a new workflow for a project or a team.
Steps:
â— Validates that either projectId or teamId is provided.
â— Creates a workflow record with states, transitions, and isDefaultWorkflow.
â— Saves the workflow and returns the created workflow object.
ğŸ”‘ getWorkflow â€“ What It Does:
Fetches a workflow scoped to a specific project.
Steps:
â— Validates projectId and workflowId.
â— Fetches the workflow and returns its states and transitions.
â— Returns a not-found message if the workflow doesnâ€™t exist for the given project.
ğŸ”‘ updateWorkflow â€“ What It Does:
Updates the name or transitions of an existing workflow.
Steps:
â— Validates the input using a schema.
â— Validates workflowId.
â— Fetches the workflow and ensures it exists and is not deleted.
â— Validates that all transitions reference valid state keys and orders.
â— Updates workflow name and transitions.
â— Saves the workflow and returns the updated object.
ğŸ”‘ deleteWorkflow â€“ What It Does:
Soft-deletes a workflow.
Steps:
â— Validates that the workflow exists and is not already deleted.
â— Sets isDeleted to true.
â— Saves the workflow and confirms deletion.
ğŸ”‘ getWorkflowForBoard â€“ What It Does:
Fetches workflows associated with a board (team or project board).
Steps:
â— Validates boardId.
â— Fetches the board and identifies whether itâ€™s a team board or project board.
â— Retrieves all workflows linked to the boardâ€™s team or project.
â— Returns a list of workflows.

board:


createBoard â€“ What It Does:
Creates a new board for a project or team, optionally using a template.
Steps:
â— Validates that either projectId or teamId is provided.
â— Validates templateId if supplied.
â— If template is provided, maps template columns and creates a workflow from template
states and transitions.
â— Creates the board with columns, workflow reference, type, and default flags.
â— Commits transaction and returns the created board (and workflow ID if created).
ğŸ”¹ getAllBoard â€“ What It Does:
Fetches all boards for a specific project.
Steps:
â— Retrieves boards filtered by projectId and not deleted.
â— Simplifies board data, including columns and default flags.
â— Returns total boards and the simplified list.
ğŸ”¹ deleteBoard â€“ What It Does:
Soft-deletes a board and its tasks.
Steps:
â— Validates boardId and ensures board exists.
â— Checks if board is team-assigned and deletable.
â— Soft-deletes all tasks associated with the board.
â— Marks board as deleted, recording the deleting user.
â— Commits transaction and confirms deletion.
ğŸ”¹ getBoardById â€“ What It Does:
Fetches a single board by ID, optionally scoped to a team or project.
Steps:
â— Validates boardId (and teamId if provided).
â— Fetches the board, including columns, workflow, and project info.
â— Returns board details or appropriate not-found error.
ğŸ”¹ addColumn â€“ What It Does:
Adds a new column to a board and syncs workflow states/transitions.
Steps:
â— Validates boardId and column name.
â— Ensures column key is unique within the board.
â— Calculates the next order value and appends column.
â— If the board has a workflow, adds a corresponding state and generates transitions
to/from existing states.
â— Commits transaction and returns the new column.
ğŸ”¹ updateColumn â€“ What It Does:
Updates a columnâ€™s name, key, or color and syncs workflow and task statuses.
Steps:
â— Validates column name and board existence.
â— Ensures the new key is not duplicated.
â— Updates column details.
â— Updates corresponding workflow state (name/key/color) if workflow exists.
â— Updates all tasks using the old column key to the new key.
â— Commits transaction and returns updated column info.
ğŸ”¹ deleteColumn â€“ What It Does:
Deletes a column from a board and removes associated workflow state/transitions.
Steps:
â— Validates boardId and column existence.
â— Prevents deletion if tasks exist in that column.
â— Removes corresponding workflow state and all transitions involving that state.
â— Removes column from the board.
â— Commits transaction and returns remaining column count.

tasks:

createTask
â— Validates request body using createTaskSchema.
â— Extracts required fields (name, boardId, status, type, etc.).
â— Checks if project exists.
â— Checks if board exists under the project.
â— Verifies if user is a project member.
â— If assignedTeamId is provided:
â—‹ Validates team existence under the same project.
â—‹ Ensures team board matches project board.
â— Prevents duplicate task names within the same board/project.
â— Validates task status against board columns.
â— Optional parent task validation:
â—‹ Must exist.
â—‹ Must belong to the same project.
â— Validates task type (task or bug).
â— Creates task with proper column reference, board, assignee, sprint, epic, parent, and
custom fields.
2. getAllTasks
â— Supports optional filtering by teamId and boardId.
â— Checks project existence.
â— Fetches tasks, populating:
â—‹ Assignee (nested user info)
â—‹ Assigned team
â—‹ Parent task (name, code)
â— Flattens assignee info for easy frontend use.
â— Returns total task count and cleaned task list.
3. deleteTask
â— Soft-deletes a task and all its sub-tasks.
â— Validates task, project, board, and optional team.
â— Uses session/transaction to ensure atomic deletion.
â— Marks isDeleted, deletedBy, deletedAt for both main task and subtasks.
â— Returns success message.
4. GetAllSubTasks
â— Fetches sub-tasks of a parent task for a given board.
â— Validates projectId, taskId, and boardId.
â— Ensures parent task belongs to the same project.
â— Returns sub-tasks sorted by creation date.
5. getTaskById
â— Validates task ID.
â— Fetches task and populates:
â—‹ Project info
â—‹ Assigned team info
â— Returns task details or 404 if not found.
6. updateTask
â— Validates taskId and projectId.
â— Checks project and task existence.
â— Validates request body using updateTaskSchema.
â— If status is updated:
â—‹ Checks if board exists.
â—‹ Validates status against board columns.
â—‹ Validates workflow transitions.
â—‹ Updates task history for status change.
â— Updates task fields atomically.
â— Logs all changes to AuditLog.
â— Returns updated task with optional status transition info.
7. reorderTasks
â— Moves task from one column to another within a board.
â— Validates task, board, project IDs.
â— Validates from and to columns exist.
â— Checks workflow for allowed transition.
â— Updates task status, column order, and history.
â— Logs the move in AuditLog.
â— Returns task and transition info.
8. getTasksByBoardColumn
â— Fetches all tasks for a given board.
â— Validates board ID.
â— Fetches board and tasks in parallel.
â— Groups tasks by board columns.
â— Populates assignee info.
â— Returns column-wise grouped tasks with tasks nested under columns.
projectmember
assignMember
â— Validates request body using addMemberSchema.
â— Checks if workspace exists under the organization.
â— Finds the workspace member and ensures they are not removed.
â— Verifies the project belongs to the workspace and organization.
â— Checks if the user is already a project member.
â— Fetches the role by name from RolePermission.
â— Creates a new ProjectMember with role, userId, projectId, workspaceId, and
organizationId.
â— Returns the added user info (email and role).
2. getAllProjectMembers
â— Requires projectId.
â— Supports pagination (page, limit).
â— Fetches project members and populates:
â—‹ User info (email, fullName)
â—‹ Role info (role, permissions)
â— Determines effective permissions (role default or custom override).
â— Returns formatted members list with pagination info.
3. UpdateProjectMember
â— Requires projectId and memberId.
â— Fetches project member and current role.
â— If role has changed:
â—‹ Fetches new role.
â—‹ Updates role, resets custom permissions.
â— If role unchanged and custom permissions are provided:
â—‹ Applies override permissions.
â— Saves updates and returns updated member info.
4. RemoveProjectMember
â— Requires memberId and projectId.
â— Fetches project member and ensures they exist.
â— Prevents removal if the member is a ProjectOwner.
â— Deletes the project member.
â— Unassigns all tasks assigned to this member.
â— Returns confirmation of removal and unassigned tasks
document
uploadDocument
â— Handles uploading files and images for a document.
â— Determines the level of the document based on what is provided:
â—‹ taskId â†’ task-level
â—‹ projectId â†’ project-level
â—‹ workspaceId â†’ workspace-level
â—‹ else â†’ organization-level
â— Uploads files to Cloudinary:
â—‹ file â†’ stored under documents/files
â—‹ image â†’ stored under documents/images
â— Saves a Document record in the database with metadata: organization, uploader, level,
file/image info.
â— Returns the created document on success.
2. getDocuments
â— Fetches documents filtered by any combination of:
â—‹ taskId, projectId, workspaceId, organizationId
â— Only includes documents that are not deleted (isDeleted = false).
â— Populates uploader info (firstName, lastName, email).
â— Returns total count and document list.
3. deleteDocument
â— Performs soft/hard delete of a document:
â—‹ Validates documentId.
â—‹ Removes file/image from Cloudinary if present.
â—‹ Deletes the document record from the database.
â— Returns confirmation of deletion.
4. getStorageUsage
â— Calculates storage usage for an organization:
â—‹ Counts total documents.
â—‹ Sums sizes of all file and image fields.
â—‹ Returns total size in bytes, MB, and GB along with file count.

project template:

1. listTemplates
â— Fetches templates filtered by:
â—‹ category (optional)
â—‹ recommended (optional boolean)
â—‹ System templates vs organization-specific templates.
â— Combines system and org-specific templates into a single list.
â— Returns total count and template details (name, description, boardType, category,
recommended, previewImage).
2. getTemplate
â— Fetches a single template by its ID.
â— Returns template data if found.
â— Returns 404 if template does not exist.
3. createTemplate
â— Validates request body using createSchema.
â— Checks for duplicate template name (system templates vs org templates).
â— Uploads preview image to Cloudinary if provided.
â— Creates a new ProjectTemplate document:
â—‹ Marks isSystem true if user is SuperAdmin.
â—‹ Stores createdBy as the current user.
â— Returns the created template data.
4. updateTemplate
â— Validates request body using updateSchema.
â— Fetches template by ID and ensures it exists.
â— Optionally enforces version control (prevents conflicts from concurrent edits).
â— Updates template fields and increments version.
â— Returns updated template data.
5. deleteTemplate
â— Fetches template by ID.
â— Prevents deletion if it is a system template (isSystem = true).
â— Deletes the template if allowed.
â— Returns confirmation message.

comment:


createComment
â— Creates a new comment for a task.
â— Supports nested comments via parentId for threading.
â— Associates the comment with:
â—‹ taskId (mandatory)
â—‹ projectId, workspaceId, organizationId (optional)
â—‹ createdBy â†’ the current user
â— Uses a transaction to ensure safe creation.
â— Returns the created comment on success.
2. getCommentsByTask
â— Fetches all non-deleted comments for a specific task.
â— Populates author info (name, avatar).
â— Builds a threaded structure:
â—‹ Comments with parentId become replies to their parent comment.
â—‹ Top-level comments (no parent) are returned as roots with replies arrays.
â— Returns the structured comment tree.
3. deleteComment
â— Performs a soft delete by setting isDeleted = true.
â— Only marks the comment as deleted; does not remove from DB.
â— Returns a confirmation message.